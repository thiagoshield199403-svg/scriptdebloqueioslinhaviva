<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Controle Di√°rio ‚Äì Equipes de Campo</title>

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>

<style>
body{
  margin:0;
  font-family: Arial, sans-serif;
  background: linear-gradient(rgba(0,0,0,.45),rgba(0,0,0,.45)), url("fundo.jpg");
  background-size: cover;
  background-attachment: fixed;
}

.container{
  background:#fff;
  margin:20px auto;
  padding:15px;
  max-width:1200px;
  border-radius:10px;
}

h2{text-align:center;margin-top:0}

.form-grid{
  display:grid;
  grid-template-columns: repeat(auto-fit,minmax(160px,1fr));
  gap:8px;
}

input,select,textarea,button{
  padding:8px;
  border-radius:6px;
  border:1px solid #ccc;
  font-size:14px;
}

textarea{resize:vertical}

.botoes{
  display:flex;
  gap:8px;
  flex-wrap:wrap;
  margin:10px 0;
}

button{
  background:#1976d2;
  color:#fff;
  border:none;
  cursor:pointer;
}

button:hover{opacity:.85}
.btn-danger{background:#c62828}
.btn-sec{background:#455a64}

#map{
  height:250px;
  margin-top:10px;
  border-radius:8px;
}

table{
  width:100%;
  border-collapse:collapse;
  margin-top:15px;
}

th,td{
  border:1px solid #ccc;
  padding:6px;
  text-align:center;
  font-size:13px;
}

th{background:#eee}

.filtros{
  display:flex;
  gap:10px;
  margin-top:10px;
  flex-wrap:wrap;
}

.resumo{
  margin-top:8px;
  font-weight:bold;
}

.alerta{
  font-size:18px;
  animation: piscar 1s infinite;
}

.alerta.vermelho{color:red}
.alerta.amarelo{color:#fbc02d}

@keyframes piscar{
  0%{opacity:1}
  50%{opacity:.3}
  100%{opacity:1}
}

/* =====================================================
   üéØ VIDA NAS CAIXAS (SEM MEXER EM PX OU LAYOUT)
   ===================================================== */

input, select, textarea {
  font-family: "Segoe UI", Roboto, Arial, sans-serif;
  font-weight: 500;
  color: #263238;
  letter-spacing: 0.2px;
  transition:
    border-color 0.2s ease,
    box-shadow 0.2s ease,
    background-color 0.2s ease;
}

input::placeholder,
textarea::placeholder {
  color: #9e9e9e;
  font-weight: 400;
}

select {
  background-color: #fafafa;
}

input:focus,
select:focus,
textarea:focus {
  outline: none;
  border-color: #1976d2;
  background-color: #ffffff;
  box-shadow: 0 0 0 2px rgba(25,118,210,0.15);
}

textarea {
  line-height: 1.4;
}
</style>
</head>

<body>
<div class="container">
<h2>Controle Di√°rio de Equipes de Campo</h2>

<div class="form-grid">
  <input id="equipe" placeholder="Equipe">
  <input id="integrantes" placeholder="Integrantes">
  <input id="telefone" placeholder="Telefone">
  <input id="viatura" placeholder="Viatura">

  <select id="radio">
    <option value="SIM" selected>R√°dio SIM</option>
    <option value="N√ÉO">R√°dio N√ÉO</option>
  </select>

  <select id="tipo">
    <option value="DUPLADA" selected>DUPLADA</option>
    <option value="SOLO">SOLO</option>
  </select>

  <select id="regional">
    <option value="">Selecione a regional</option>
    <option>ARACAJU</option>
    <option>S√ÉO CRIST√ìV√ÉO</option>
    <option>N. S. DO SOCORRO</option>
    <option>ITABAIANA</option>
    <option>LAGARTO</option>
    <option>N. S. DAS DORES</option>
    <option>PROPRI√Å</option>
    <option>MARUIM</option>
  </select>
</div>

<div class="form-grid" style="margin-top:8px">
  <textarea id="obs" placeholder="Observa√ß√µes"></textarea>

  <select id="alerta">
    <option value="">Sem prioridade</option>
    <option value="‚è±Ô∏è Religa√ß√£o vencendo 8h">‚è±Ô∏è Religa√ß√£o vencendo 8h</option>
    <option value="üí∞ Comercial ‚Äì Compensa√ß√£o Alta">üí∞ Comercial ‚Äì Compensa√ß√£o Alta</option>
    <option value="üö® Risco √† Vida">üö® Risco √† Vida</option>
    <option value="‚ö° Falta de Fase">‚ö° Falta de Fase</option>
    <option value="‚≠ê FE ‚Äì Cliente VIP">‚≠ê FE ‚Äì Cliente VIP</option>
    <option value="üì¢ Solicita√ß√£o da Supervis√£o">üì¢ Solicita√ß√£o da Supervis√£o</option>
  </select>
</div>

<div class="botoes">
  <button onclick="salvar()">Adicionar √† Lista</button>
  <button onclick="limpar()" class="btn-sec">Limpar Campos</button>
  <button onclick="exportar()">Exportar Excel</button>
  <button onclick="toggleMapa()">Recolher / Mostrar Mapa</button>
  <button onclick="limparLista()" class="btn-danger">Limpar Lista</button>
</div>

<div id="map"></div>

<div class="filtros">
  <input id="busca" placeholder="Buscar equipe" onkeyup="render()">
  <select id="filtroRegional" onchange="render()">
    <option value="">Todas Regionais</option>
    <option>ARACAJU</option>
    <option>S√ÉO CRIST√ìV√ÉO</option>
    <option>N. S. DO SOCORRO</option>
    <option>ITABAIANA</option>
    <option>LAGARTO</option>
    <option>N. S. DAS DORES</option>
    <option>PROPRI√Å</option>
    <option>MARUIM</option>
  </select>
</div>

<div class="resumo" id="resumo"></div>

<table>
<thead>
<tr>
<th>Equipe</th>
<th>Integrantes</th>
<th>Telefone</th>
<th>Viatura</th>
<th>R√°dio</th>
<th>Tipo</th>
<th>Regional</th>
<th>Obs</th>
<th>‚ö†</th>
<th>Mapa</th>
<th>A√ß√µes</th>
</tr>
</thead>
<tbody id="tabela"></tbody>
</table>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
let dados=JSON.parse(localStorage.getItem("equipes"))||[];
let edit=null, lat=null,lng=null,markers=[];
const map=L.map("map").setView([-10.9472,-37.0731],11);
L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png").addTo(map);

map.on("click",e=>{
  lat=e.latlng.lat; lng=e.latlng.lng;
  alert("Localiza√ß√£o definida");
});

function salvar(){
  if(!equipe.value)return alert("Informe a equipe");

  const obj={
    equipe:equipe.value.toUpperCase(),
    integrantes:integrantes.value,
    telefone:telefone.value,
    viatura:viatura.value,
    radio:radio.value,
    tipo:tipo.value,
    regional:regional.value,
    obs:obs.value,
    alerta:alerta.value,
    lat,lng
  };

  if(edit!==null){dados[edit]=obj;edit=null;}
  else dados.push(obj);

  dados.sort((a,b)=>a.equipe.localeCompare(b.equipe,"pt-BR"));
  localStorage.setItem("equipes",JSON.stringify(dados));
  limpar(); render();
}

function render(){
  tabela.innerHTML=""; markers.forEach(m=>map.removeLayer(m)); markers=[];
  let total=0;

  dados.forEach((d,i)=>{
    if((!busca.value||d.equipe.includes(busca.value.toUpperCase())) &&
       (!filtroRegional.value||d.regional===filtroRegional.value)){
      total++;

      let icone = "";
      if (d.alerta) {
        let emoji = d.alerta.match(/^[^\s]+/)[0];
        let cor = d.alerta.includes("Religa√ß√£o") || d.alerta.includes("Falta")
          ? "amarelo"
          : "vermelho";

        icone = `
          <span class="alerta ${cor}" title="${d.alerta}">
            ${emoji}
          </span>`;
      }

      tabela.innerHTML+=`
      <tr>
        <td style="cursor:pointer; color:#1976d2; font-weight:bold" onclick="focarMapa(${i})">
          ${d.equipe}
        </td>
        <td>${d.integrantes||"-"}</td>
        <td>${d.telefone||"-"}</td>
        <td>${d.viatura||"-"}</td>
        <td>${d.radio}</td>
        <td>${d.tipo}</td>
        <td>${d.regional||"-"}</td>
        <td>${d.obs||"-"}</td>
        <td>${icone}</td>
        <td>${d.lat?`<a target="_blank" href="https://www.google.com/maps?q=${d.lat},${d.lng}">Ver</a>`:"-"}</td>
        <td>
          <button onclick="editar(${i})">‚úèÔ∏è</button>
          <button onclick="remover(${i})" class="btn-danger">üóëÔ∏è</button>
        </td>
      </tr>`;

      if(d.lat){
        markers.push(L.marker([d.lat,d.lng]).addTo(map).bindPopup(d.equipe));
      }
    }
  });
  resumo.innerText=`Total de equipes exibidas: ${total}`;
}

/* ===============================
   üìç CENTRALIZAR MAPA
   =============================== */
function focarMapa(i){
  let d = dados[i];
  if(d.lat && d.lng){
    map.setView([d.lat, d.lng], 15, { animate: true });

    markers.forEach(m=>{
      const pos = m.getLatLng();
      if(pos.lat == d.lat && pos.lng == d.lng){
        m.openPopup();
      }
    });
  }else{
    alert("Esta equipe n√£o possui localiza√ß√£o definida no mapa.");
  }
}

function editar(i){
  let d=dados[i];
  equipe.value=d.equipe;
  integrantes.value=d.integrantes;
  telefone.value=d.telefone;
  viatura.value=d.viatura;
  radio.value=d.radio;
  tipo.value=d.tipo;
  regional.value=d.regional;
  obs.value=d.obs;
  alerta.value=d.alerta;
  lat=d.lat; lng=d.lng;
  edit=i;
}

function remover(i){
  if(confirm("Remover equipe?")){
    dados.splice(i,1);
    localStorage.setItem("equipes",JSON.stringify(dados));
    render();
  }
}

function limpar(){
  document.querySelectorAll("input,textarea").forEach(e=>e.value="");
  alerta.value="";
  regional.value="";
  lat=lng=null; edit=null;
}

function limparLista(){
  if(confirm("Limpar TODA a lista?")){
    dados=[]; localStorage.removeItem("equipes"); render();
  }
}

function exportar(){
  let csv="Equipe;Integrantes;Telefone;Viatura;R√°dio;Tipo;Regional;Obs;Alerta\n";
  dados.forEach(d=>{
    csv+=`${d.equipe};${d.integrantes};${d.telefone};${d.viatura};${d.radio};${d.tipo};${d.regional};${d.obs};${d.alerta}\n`;
  });
  let a=document.createElement("a");
  a.href=URL.createObjectURL(new Blob([csv],{type:"text/csv"}));
  a.download="equipes.csv"; a.click();
}

function toggleMapa(){
  map.getContainer().style.display=
  map.getContainer().style.display==="none"?"block":"none";
}

render();
</script>
</body>
</html>
